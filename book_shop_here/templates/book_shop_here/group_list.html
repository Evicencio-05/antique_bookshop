{% extends "book_shop_here/base.html" %}
{% load i18n %}

{% block content %}
    <h1>{% trans "Groups" %}</h1>
    <form method="get">
        <input type="text" name="q" value="{{ query }}" placeholder="{% trans 'Search by group name' %}">
        <button type="submit">{% trans "Search" %}</button>
    </form>
    <p><a href="{% url 'book_shop_here:group-create' %}">{% trans "Add Group" %}</a></p>
    {% if messages %}
        <ul class="messages">
        {% for message in messages %}
            <li {% if message.tags %} class="{{ message.tags }}"{% endif %}>{{ message }}</li>
        {% endfor %}
        </ul>
    {% endif %}
    {% if groups %}
        <table style="width: 100%; border=2px solid black; border-collapse: collapse;">
        <tr>
            <th>{% trans "Name" %}</th>
            <th>{% trans "Description" %}</th>
            <th>{% trans "Permissions" %}</th>
            <th>{% trans "Actions" %}</th>
        </tr>
        {% for group in groups %}
            <tr>
            <td>{{ group.name }}</td>
            <td>{{ group.profile.description|default:"-" }}</td>
            <td>
                <table style="border: 1px solid #ddd; width: 100%; border-collapse: collapse;">
                    <thead>
                        <tr>
                            <th style="border: 1px solid #ddd; padding: 6px; text-align: left;">{% trans "Permission" %}</th>
                            {% for model in permission_models %}
                                <th style="border: 1px solid #ddd; padding: 6px; text-transform: capitalize;">{{ model }}</th>
                            {% endfor %}
                        </tr>
                    </thead>
                    <tbody>
                        {% for action in permission_actions %}
                            <tr>
                                <td style="border: 1px solid #ddd; padding: 6px;">{{ action.1 }}</td>
                                {% for model in permission_models %}
                                    {% with codename=action.0|add:"_"|add:model %}
                                        <td style="border: 1px solid #ddd; padding: 6px; text-align: center;">
                                            {% if codename in group.perm_codenames %}
                                                <span style="color: #16a34a;">&#10003;</span>
                                            {% else %}
                                                <span style="color: #dc2626;">&#10007;</span>
                                            {% endif %}
                                        </td>
                                    {% endwith %}
                                {% endfor %}
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </td>
            <td>
                <a href="{% url 'book_shop_here:group-update' pk=group.id %}">{% trans "Edit" %}</a> |
                <a href="{% url 'book_shop_here:group-delete' pk=group.id %}">{% trans "Delete" %}</a>
            </td>
            </tr>
        {% endfor %}
        {% if groups_display %}
            {% for gd in groups_display %}
                <tr class="sr-only"><td colspan="4">{{ gd.name }} - {{ gd.description }}</td></tr>
                <tr class="sr-only"><td colspan="4">{{ gd.base_name }} - {{ gd.description }}</td></tr>
            {% endfor %}
        {% endif %}
        </table>
    {% else %}
        <p>{% trans "No groups found." %}</p>
    {% endif %}
{% endblock %}
